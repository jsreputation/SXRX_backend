# ============================================
# SXRX Backend Environment Variables
# ============================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control

# ============================================
# Server Configuration
# ============================================
PORT=3000
NODE_ENV=development

# ============================================
# Tebra (EHR) Configuration
# ============================================
# Tebra SOAP API credentials
TEBRA_SOAP_WSDL=https://webservice.kareo.com/services/soap/2.1/KareoServices.svc?wsdl
TEBRA_SOAP_ENDPOINT=https://webservice.kareo.com/services/soap/2.1/KareoServices.svc
TEBRA_SOAP_NAMESPACE=http://www.kareo.com/api/schemas/
TEBRA_CUSTOMER_KEY=your_customer_key
# TEBRA_CUSTOMER_ID=110826
# ^ Optional: if "Error translating to CreateAppointmentV3Request" persists, set to SecurityResponse.CustomerId from a Tebra response (e.g. 110826)
TEBRA_PASSWORD=your_password
TEBRA_USER=your_username
TEBRA_PRACTICE_NAME=Your Practice Name

# Tebra Practice IDs (state-specific)
TEBRA_PRACTICE_ID=your_default_practice_id
TEBRA_PRACTICE_ID_CA=your_ca_practice_id
TEBRA_PRACTICE_ID_TX=your_tx_practice_id
TEBRA_PRACTICE_ID_WA=your_wa_practice_id
TEBRA_PRACTICE_ID_KL=your_kl_practice_id
TEBRA_PRACTICE_ID_SC=your_sc_practice_id

# Tebra Practice Names (state-specific)
TEBRA_PRACTICE_NAME_CA=Your CA Practice Name
TEBRA_PRACTICE_NAME_TX=Your TX Practice Name
TEBRA_PRACTICE_NAME_WA=Your WA Practice Name
TEBRA_PRACTICE_NAME_KL=Your KL Practice Name
TEBRA_PRACTICE_NAME_SC=Your SC Practice Name

# Tebra Provider IDs (state-specific) - These should be your Medical Director IDs
TEBRA_PROVIDER_ID=your_default_provider_id
TEBRA_PROVIDER_ID_CA=your_ca_provider_id
TEBRA_PROVIDER_ID_TX=your_tx_provider_id
TEBRA_PROVIDER_ID_WA=your_wa_provider_id
TEBRA_PROVIDER_ID_KL=your_kl_provider_id
TEBRA_PROVIDER_ID_SC=your_sc_provider_id

# Tebra Appointment Reason (required for CreateAppointment)
# Run: node scripts/list-tebra-appointment-reasons.js [practiceId]  to list IDs/names
TEBRA_DEFAULT_APPT_REASON_ID=
TEBRA_DEFAULT_APPT_REASON_NAME=
# Or state-specific: TEBRA_APPT_REASON_ID_CA=123  or  TEBRA_APPT_REASON_NAME_CA=Consultation

# Tebra Service Location (required for CreateAppointment; use practice default if unset)
# TEBRA_SERVICE_LOCATION_ID=1
# TEBRA_SERVICE_LOCATION_ID_CA=1

# Tebra Medical Director Verification (optional - for clarity)
# These should match the provider IDs above, but explicitly labeled as medical director
TEBRA_MEDICAL_DIRECTOR_ID_CA=your_ca_medical_director_id
TEBRA_MEDICAL_DIRECTOR_NAME_CA=Dr. Medical Director Name
TEBRA_MEDICAL_DIRECTOR_ID_TX=your_tx_medical_director_id
TEBRA_MEDICAL_DIRECTOR_NAME_TX=Dr. Medical Director Name
TEBRA_MEDICAL_DIRECTOR_ID_WA=your_wa_medical_director_id
TEBRA_MEDICAL_DIRECTOR_NAME_WA=Dr. Medical Director Name

# Tebra Recurring Support (set to true if Tebra supports recurring appointments/charges)
TEBRA_SUPPORTS_RECURRING_APPOINTMENTS=false
TEBRA_SUPPORTS_RECURRING_CHARGES=false

# Tebra Billing Configuration
TEBRA_BILLING_SOAP_ACTION_BASE=http://www.kareo.com/api/KareoServices/IKareoServices
TEBRA_ALWAYS_CREATE_BILLING_DOCUMENTS=false

# Tebra SOAP Configuration
TEBRA_USE_RAW_SOAP=true
# Optional: DEBUG_TEBRA_RAW=GetAppointmentReasons to log raw GetAppointmentReasons response (if AppointmentReason id is undefined)
# Optional: set to true to skip UpdatePatient during /book when it returns InternalServiceFault (Tebra server-side). Booking still proceeds.
# TEBRA_SKIP_UPDATE_PATIENT_ON_BOOK=false
TEBRA_BATCH_SIZE=5
TEBRA_DELAY_BETWEEN_CALLS=200
TEBRA_DELAY_BETWEEN_BATCHES=1000
TEBRA_DELAY_AFTER_GET_IDS=500

# ============================================
# SendGrid Email Configuration
# ============================================
# Get your API key from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.your_sendgrid_api_key_here

# From email address (must be verified in SendGrid)
SENDGRID_FROM=noreply@yourdomain.com

# Medical Director/Provider Alert Email
# This is where red flag notifications are sent
MEDICAL_DIRECTOR_EMAIL=medical.director@yourdomain.com
PROVIDER_ALERT_EMAIL=alerts@yourdomain.com

# Medical Director Phone (optional, for SMS notifications if implemented)
MEDICAL_DIRECTOR_PHONE=+1234567890
ALERT_PHONE=+1234567890

# ============================================
# Pharmacy/eRx Configuration
# ============================================
# eRx Provider: 'tebra', 'surescripts', 'drfirst', or 'stub' (default)
# 'stub' mode does NOT actually send prescriptions - for testing only
ERX_PROVIDER=stub

# Surescripts Configuration (if ERX_PROVIDER=surescripts)
# Contact Surescripts to get API credentials: https://surescripts.com
ERX_API_KEY=your_surescripts_api_key
ERX_API_SECRET=your_surescripts_api_secret
ERX_BASE_URL=https://api.surescripts.com

# DrFirst Configuration (if ERX_PROVIDER=drfirst)
# Contact DrFirst to get API credentials: https://www.drfirst.com
# Use same variable names as Surescripts above

# Tebra Native eRx (if ERX_PROVIDER=tebra)
# Uses existing Tebra SOAP credentials above
# May require additional Tebra eRx module activation

# ============================================
# Qualiphy Integration
# ============================================
# Enable Qualiphy for consultation routing
USE_QUALIPHY=false

# Qualiphy API credentials (if USE_QUALIPHY=true)
# Contact Qualiphy to get API credentials
QUALIPHY_API_KEY=your_qualiphy_api_key
QUALIPHY_API_SECRET=your_qualiphy_api_secret
QUALIPHY_BASE_URL=https://api.qualiphy.com

# ============================================
# Shopify Configuration
# ============================================
SHOPIFY_STORE_DOMAIN=your-store.myshopify.com
SHOPIFY_API_KEY=your_shopify_api_key
SHOPIFY_API_SECRET=your_shopify_api_secret
SHOPIFY_ACCESS_TOKEN=your_shopify_access_token
SHOPIFY_STOREFRONT_ACCESS_TOKEN=your_storefront_access_token

# ============================================
# Database Configuration
# ============================================
# PostgreSQL connection string
DATABASE_URL=postgresql://username:password@localhost:5432/sxrx_db

# Or individual connection parameters
DB_HOST=localhost
DB_PORT=5432
DB_NAME=sxrx_db
DB_USER=your_db_user
DB_PASSWORD=your_db_password

# ============================================
# Application URLs
# ============================================
BACKEND_URL=http://localhost:3000
FRONTEND_URL=http://localhost:3001
SHOPIFY_STORE_URL=https://your-store.myshopify.com

# ============================================
# Feature Flags
# ============================================
# Auto-sync Tebra patient creation on login/registration
AUTO_SYNC_TEBRA=true

# ============================================
# Security
# ============================================
# JWT Secret (if using JWT authentication)
JWT_SECRET=your_jwt_secret_key_here

# Session Secret
SESSION_SECRET=your_session_secret_here

# ============================================
# Logging
# ============================================
LOG_LEVEL=info
# Options: error, warn, info, debug

# ============================================
# Development/Testing
# ============================================
# Test Patient ID for recurring appointment testing
TEST_PATIENT_ID=your_test_patient_id

# ============================================
# Notes
# ============================================
# 1. SendGrid: Sign up at https://sendgrid.com and create an API key
#    - Verify your sender email address in SendGrid dashboard
#    - Free tier allows 100 emails/day
#
# 2. ERX Provider: 
#    - 'stub' mode is for development/testing only
#    - For production, configure actual eRx provider (Surescripts/DrFirst/Tebra)
#    - Contact respective providers to get API credentials
#
# 3. Medical Director IDs:
#    - These should be the actual provider IDs from Tebra
#    - Verify these IDs correspond to your medical director in Tebra
#    - Use Tebra API or admin panel to find correct provider IDs
#
# 4. Tebra Recurring Support:
#    - Test with Tebra API to verify recurring appointment/charge support
#    - Update TEBRA_SUPPORTS_RECURRING_* flags based on test results
#
# 5. Qualiphy:
#    - Set USE_QUALIPHY=true to enable Qualiphy consultation routing
#    - Contact Qualiphy for API credentials and integration details

# Webhook Secrets (for signature verification)
# Shopify webhook secret - Get from Shopify Admin > Settings > Notifications > Webhooks
SHOPIFY_WEBHOOK_SECRET=your_shopify_webhook_secret_here
# Alternative: Can use SHOPIFY_API_SECRET_KEY if webhook secret not available


# Admin API Key (for admin endpoints like /api/availability/settings)
ADMIN_API_KEY=your_admin_api_key_here
# Generate a strong random key: openssl rand -hex 32

# Allow unsigned webhooks in development (set to 'true' to skip verification)
ALLOW_UNSIGNED_WEBHOOKS=false
